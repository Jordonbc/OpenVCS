/* ================= Theme tokens ================= */
:root {
  /* Palette */
  --bg:#242424; --surface:#2a2a2a; --surface-2:#313131;
  --text:#e6e6e6; --muted:#b7bcc5; --border:rgba(255,255,255,.08);
  --accent:#3584e4; --accent-2:#4c94ea; --danger:#c01c28; --success:#26a269; --warning:#f59e0b;
  --shadow-1:none;

  /* Radii */
  --r-xs:4px; --r-sm:6px; --r-md:6px; --r-lg:8px;

  /* Fonts */
  --font:"Cantarell",system-ui,-apple-system,"Inter",Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace;

  /* Form-control tokens (dark) */
  --control-bg:#1f2126;
  --control-bg-focus:#24272d;
  --control-border:#3a3f47;
  --control-text:#e8ebf1;
  --control-muted:#a6aebb;

  font-family:var(--font);
  /* Drive base UI scale from a CSS var (defaults to 1) */
  font-size: calc(15px * var(--ui-scale, 1));
}

:root[data-theme="dark"] { color-scheme: dark; }

[data-theme="light"] {
  --bg:#f6f6f7; --surface:#fff; --surface-2:#f0f0f2;
  --text:#1b1b1c; --muted:#666c76; --border:rgba(0,0,0,.12);
  --shadow-1:none;
}

/* ================= Base ================= */
* { box-sizing:border-box; scrollbar-width:thin; scrollbar-color:var(--border) transparent; }
html,body { height:100%; overflow:hidden; }
html { background:var(--bg); color:var(--text); }
body { margin:0; font-family:var(--font); }
:focus-visible { outline:2px solid var(--accent); outline-offset:2px; }
::selection { background:rgba(53,132,228,.28); }
::-webkit-scrollbar { width:10px; height:10px; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:10px; }

/* ================= App Layout ================= */
.app { display:flex; flex-direction:column; height:100vh; overflow:hidden; }
.titlebar { height:40px; display:flex; align-items:center; gap:.6rem; padding:0 .6rem; border-bottom:1px solid var(--border); background:var(--surface); }
.repo-switch { display:flex; align-items:center; gap:.6rem; background:var(--surface-2); padding:.35rem .6rem; border-radius:var(--r-sm); cursor:pointer; min-width:220px; user-select:none; }
.repo-switch:hover { outline:1px solid var(--border); }
.repo-meta { display:flex; flex-direction:column; min-width:0; flex:1; }
.repo-title { font-weight:700; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.repo-branch { color:var(--muted); font-size:.82rem; }
.title-actions { margin-left:auto; display:flex; align-items:center; gap:.45rem; }

.btn,.tbtn,.pick {
  border:1px solid var(--border); background:var(--surface); color:var(--text);
  cursor:pointer; padding:.42rem .66rem; border-radius:var(--r-sm); font:inherit;
  transition:border-color .15s, background-color .15s, transform .06s; will-change:transform;
}
.btn:hover,.tbtn:hover,.pick:hover { border-color:var(--accent); }
.btn:active,.tbtn:active,.pick:active { transform:translateY(1px); }
.btn.icon { padding:.32rem .5rem; border-radius:var(--r-sm); }
.btn.primary,.tbtn.primary { background:var(--accent); border-color:var(--accent); color:#fff; font-weight:600; }
.btn.primary:hover,.tbtn.primary:hover { background:var(--accent-2); }
.tbtn.primary.big { padding:.55rem .9rem; border-radius:var(--r-lg); }

button:disabled,.btn:disabled,.btn.primary:disabled,.tbtn:disabled,.pick:disabled {
  opacity:.55; cursor:not-allowed; pointer-events:none; transform:none !important;
}
.btn.primary:disabled,.tbtn.primary:disabled { background:var(--surface-2); border-color:var(--border); color:var(--muted); }

.tabs { display:flex; align-items:center; gap:.25rem; border-bottom:1px solid var(--border); background:var(--surface); padding:0 .5rem; height:36px; }
.tab { border:none; background:transparent; color:var(--muted); padding:.55rem .75rem; cursor:pointer; border-bottom:2px solid transparent; }
.tab:hover { color:var(--text); }
.tab.active { color:var(--text); border-bottom-color:var(--accent); }

.work { flex:1 1 auto; display:grid; grid-template-columns:minmax(220px, 32vw) 6px 1fr; min-height:0; width:100%; overflow:hidden; }
.panel,.left,.right,.diff { min-width:0; }
.left { background:var(--surface); border-right:1px solid var(--border); display:flex; flex-direction:column; min-height:0; }
.right { background:var(--surface-2); display:flex; flex-direction:column; min-height:0; overflow:hidden; }
.resizer { background:transparent; cursor:col-resize; }
.resizer:hover { background:rgba(255,255,255,.04); }

.left-head { display:flex; align-items:center; gap:.6rem; padding:.5rem; border-bottom:1px solid var(--border); flex:0 0 auto; }
.filter { flex:1; display:flex; align-items:center; gap:.4rem; border:1px solid var(--border); border-radius:999px; padding:.3rem .6rem; background:transparent; }
.filter input { flex:1; min-width:0; border:none; outline:none; background:transparent; color:var(--text); }
.filter-icon { opacity:.85; }
.badge { font-size:.78rem; color:var(--muted); border:1px solid var(--border); padding:.15rem .45rem; border-radius:999px; }

.list { list-style:none; margin:0; padding:.25rem; display:flex; flex-direction:column; gap:.25rem; flex:1 1 auto; overflow:auto; }
.row { display:flex; align-items:center; gap:.6rem; padding:.5rem .6rem; border-radius:var(--r-md); border:1px solid transparent; cursor:pointer; }
.row:hover { background:rgba(255,255,255,.04); }
.row.active { background:rgba(53,132,228,.12); border-color:rgba(53,132,228,.35); }
.file { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.status.add { color:var(--success); } .status.mod { color:#8b5cf6; } .status.del { color:var(--danger); }

.diff-head { display:flex; align-items:center; justify-content:space-between; gap:.6rem; padding:.6rem .8rem; border-bottom:1px solid var(--border); flex:0 0 auto; }
.path { font-weight:600; }
.meta { color:var(--muted); font-size:.85rem; display:flex; gap:.6rem; }

.diff { flex:1 1 auto; overflow:auto; font-family:var(--mono); font-size:13px; }
.hunk { padding:.25rem 0; }
.hline { display:grid; grid-template-columns:56px 1fr; gap:.6rem; padding:.15rem .8rem; }
.gutter { color:var(--muted); text-align:right; user-select:none; }
.code { white-space:pre; tab-size: var(--tab-size, 4); -moz-tab-size: var(--tab-size, 4); }
.hline.add { background:rgba(38,162,105,.12); }
.hline.del { background:rgba(192,28,40,.12); }

.commit { border-top:1px solid var(--border); background:var(--surface); padding:.6rem .8rem; display:grid; grid-template-columns:1fr auto; gap:.6rem; align-items:center; flex:0 0 auto; }
.commit .inputs { display:grid; gap:.4rem; }
.commit input,.commit textarea { width:100%; border:1px solid var(--border); background:var(--surface-2); color:var(--text); border-radius:var(--r-sm); padding:.55rem .65rem; }
.commit textarea { min-height:64px; resize:vertical; }
.kbd { border:1px solid var(--border); border-bottom-width:2px; border-radius:6px; padding:.05rem .32rem; color:var(--muted); font-size:.8rem; }

.footer { height:34px; border-top:1px solid var(--border); background:var(--surface); display:flex; align-items:center; justify-content:space-between; padding:0 .8rem; font-size:.82rem; color:var(--muted); }

.titlebar,.tabs,.footer { flex:0 0 auto; }

/* ================= Branch switcher ================= */
.branch-switch {
  display:inline-flex; align-items:center; gap:.45rem; margin-left:.4rem; padding:.35rem .6rem;
  border-radius:var(--r-sm); border:1px solid var(--border); background:var(--surface); color:var(--text);
  cursor:pointer; font:inherit;
}
.branch-switch:hover { border-color:var(--accent); }
.branch-switch .chev { opacity:.8; }
.branch-dot { width:8px; height:8px; border-radius:999px; background:var(--accent); box-shadow:0 0 0 2px rgba(53,132,228,.18); }

/* ================= Popover ================= */
.popover[hidden] { display:none !important; }
.popover {
  position:absolute; z-index:70; min-width:280px; max-height:60vh; overflow:auto;
  background:var(--surface); color:var(--text); border:1px solid var(--border);
  border-radius:var(--r-lg); box-shadow:var(--shadow-1);
}
.pop-head { display:flex; gap:.5rem; align-items:center; padding:.5rem; border-bottom:1px solid var(--border); background:var(--surface-2); }
#branch-filter { flex:1; border:1px solid var(--border); background:var(--surface); color:var(--text); border-radius:var(--r-sm); padding:.5rem .6rem; }
.pop-list { list-style:none; margin:0; padding:.35rem; display:grid; gap:.25rem; }
.pop-list li { display:flex; align-items:center; justify-content:space-between; gap:.5rem; padding:.5rem .6rem; border-radius:var(--r-sm); cursor:pointer; }
.pop-list li:hover { background:rgba(255,255,255,.04); }
.pop-list li[aria-selected="true"] { background:rgba(53,132,228,.12); outline:1px solid rgba(53,132,228,.35); }
.pop-list .label { display:inline-flex; align-items:center; gap:.45rem; min-width:0; }
.pop-list .name { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.pop-list .badge { border-radius:999px; font-size:.75rem; }

/* ================= Modal (command sheet + settings) ================= */
/* One source of truth: aria-hidden controls visibility, flex keeps it centered */
.modal {
  position:fixed; inset:0; z-index:50; padding:12px;
  display:flex; align-items:center; justify-content:center;
}
.modal[aria-hidden="true"] { display:none; }

.backdrop { position:absolute; inset:0; background:rgba(0,0,0,.55); }
.dialog.sheet {
  position:relative; background:var(--surface); border:1px solid var(--border); border-radius:var(--r-lg);
  box-shadow:var(--shadow-1); overflow:hidden;
  width:clamp(560px, 92vw, 960px);
  height:min(640px, calc(100vh - 24px));
  display:flex; flex-direction:column; /* header + body stack */
}
.sheet-head { display:flex; align-items:center; justify-content:space-between; gap:.5rem; padding:.6rem; border-bottom:1px solid var(--border); background:var(--surface-2); }
.seg { display:inline-flex; border:1px solid var(--border); border-radius:999px; padding:2px; background:transparent; }
.seg.small { padding:2px; }
.seg-btn { border:none; background:transparent; color:var(--muted); padding:.4rem .85rem; border-radius:999px; cursor:pointer; }
.seg-btn.small { padding:.25rem .6rem; font-size:.85rem; }
.seg-btn.active { background:var(--surface); color:var(--text); border:1px solid var(--border); }
.icon.close { border:none; background:transparent; color:var(--muted); cursor:pointer; padding:.35rem; }
.icon.close:hover { color:var(--text); }

.sheet-body {
  flex:1 1 auto; min-height:0; overflow:hidden;
  display:grid; grid-template-columns:240px 1fr; gap:1rem; padding:1rem;
}
#settings-modal nav { overflow:auto; padding-right:.25rem; }
#settings-modal nav ul { display:grid; gap:.25rem; margin:0; padding:0; }
#settings-modal nav .seg-btn { width:100%; text-align:left; justify-content:flex-start; padding:.5rem .75rem; }
#settings-modal nav .seg-btn.active { background:var(--surface); color:var(--text); border:1px solid var(--border); }

#settings-panels { display:grid; gap:1rem; min-height:0; overflow:auto; padding-right:.25rem; }
.panel-form { display:grid; gap:.8rem; }
.panel-form.hidden { display:none; }

.group { display:grid; gap:.45rem; }
.group label { color:var(--muted); font-size:.85rem; }
.input-row { display:flex; gap:.6rem; align-items:center; }
.input-row input { flex:1; border:1px solid var(--border); background:var(--surface-2); color:var(--text); border-radius:var(--r-sm); padding:.6rem .75rem; }
.hint { color:var(--muted); font-size:.8rem; }

#settings-modal .sheet-actions {
  position:sticky; bottom:0; background:var(--surface);
  border-top:1px solid var(--border); padding-top:.5rem; display:flex; justify-content:flex-end; gap:.5rem;
}
#settings-modal .sheet-actions .tbtn { height:auto; }
.tbtn.primary:disabled { opacity:.6; cursor:not-allowed; }

/* Settings form fields */
.panel-form .group label{ color:var(--muted); }
.panel-form input[type="text"],
.panel-form input[type="number"],
.panel-form select {
  width:100%; border:1px solid var(--border); background:var(--surface-2); color:var(--text);
  border-radius:var(--r-sm); padding:.55rem .65rem; font:inherit;
}
.panel-form input[type="number"]{ text-align:right; }
.panel-form .checkbox{ display:flex; align-items:center; gap:.6rem; }
.panel-form .checkbox input{ width:1.1rem; height:1.1rem; }

/* Toggle switch */
.switch { display:inline-flex; align-items:center; }
.switch input[type="checkbox"] {
  appearance:none; width:42px; height:24px; position:relative; border-radius:999px;
  background:var(--surface-2); border:1px solid var(--border);
  transition:background-color .15s, border-color .15s; outline:none; cursor:pointer;
}
.switch input[type="checkbox"]::after {
  content:""; position:absolute; top:2px; left:2px; width:20px; height:20px; border-radius:999px;
  background:var(--text); opacity:.85; transition:transform .15s;
}
.switch input[type="checkbox"]:checked { background:var(--accent); border-color:var(--accent); }
.switch input[type="checkbox"]:checked::after { transform:translateX(18px); }

/* Dark-styled native controls inside overlays */
#settings-modal select,
#settings-modal input[type="text"],
#settings-modal input[type="number"],
#settings-modal input[type="search"],
#settings-modal textarea,
#modal select,
#modal input[type="text"],
#modal input[type="number"],
#modal input[type="search"],
#modal textarea,
.popover input[type="search"] {
  background-color:var(--control-bg);
  color:var(--control-text);
  border:1px solid var(--control-border);
  border-radius:8px;
  padding:8px 10px; line-height:1.2; width:100%; box-sizing:border-box;
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
}
#settings-modal ::placeholder, #modal ::placeholder, .popover ::placeholder { color:var(--control-muted); }
#settings-modal :disabled, #modal :disabled { opacity:.7; cursor:not-allowed; }
#settings-modal input[type="checkbox"],
#settings-modal input[type="radio"],
#modal input[type="checkbox"],
#modal input[type="radio"] { accent-color:var(--accent); }
#settings-modal select option, #modal select option { background-color:var(--control-bg); color:var(--control-text); }

/* ================= Utilities & Lists ================= */
.hidden { display:none !important; }
.recent { list-style:none; margin:0; padding:0; display:grid; gap:.4rem; max-height:40vh; overflow:auto; }
.recent li { display:flex; justify-content:space-between; gap:.75rem; align-items:center; border:1px solid var(--border); background:var(--surface); padding:.6rem .8rem; border-radius:var(--r-md); cursor:pointer; }
.recent li:hover { border-color:var(--accent); }
.recent .path { color:var(--muted); font-size:.85rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* ================= Responsive ================= */
@media (max-width:980px){
  .work{ grid-template-columns:1fr; }
  .resizer{ display:none; }
  .left{ order:1; height:42vh; }
  .right{ order:2; height:58vh; }
}
@media (max-width:880px){
  .sheet-body{ grid-template-columns:1fr; }
  #settings-modal nav ul{
    display:grid; grid-auto-flow:column; grid-auto-columns:max-content;
    gap:.5rem; overflow:auto; padding-bottom:.25rem;
  }
  #settings-modal nav .seg-btn{ text-align:center; }
}

/* ================= Motion ================= */
@media (prefers-reduced-motion:reduce){
  *{ transition:none !important; animation:none !important; }
}
